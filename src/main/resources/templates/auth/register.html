<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ÄÄƒng kÃ½ - OneShop</title>
</head>
<body>
<div class="container mt-5" style="max-width: 500px;">
    <div class="card shadow-sm">
        <div class="card-body">
            <h4 class="card-title text-center mb-4">ğŸ“ ÄÄƒng kÃ½ tÃ i khoáº£n OneShop</h4>

            <form id="registerForm">
                <div class="mb-3">
                    <label for="fullname" class="form-label">Há» vÃ  tÃªn</label>
                    <input type="text" class="form-control" id="fullname" name="fullname"
                           placeholder="Nháº­p há» tÃªn Ä‘áº§y Ä‘á»§" required>
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email"
                           placeholder="Nháº­p email" required>
                </div>

                <div class="mb-3">
                    <label for="username" class="form-label">TÃªn Ä‘Äƒng nháº­p</label>
                    <input type="text" class="form-control" id="username" name="username"
                           placeholder="TÃªn Ä‘Äƒng nháº­p" required>
                </div>

                <div class="mb-3">
                    <label for="password" class="form-label">Máº­t kháº©u</label>
                    <input type="password" class="form-control" id="password" name="password"
                           placeholder="Máº­t kháº©u" required>
                </div>

                <button type="submit" class="btn btn-success w-100">ÄÄƒng kÃ½</button>

                <div class="text-center mt-3">
                    <p>ÄÃ£ cÃ³ tÃ i khoáº£n? <a th:href="@{/login}">ÄÄƒng nháº­p ngay</a></p>
                </div>

                <div id="message" class="mt-3 text-center fw-bold"></div>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const body = {
        username: document.getElementById("username").value.trim(),
        email: document.getElementById("email").value.trim(),
        password: document.getElementById("password").value,
        // trÆ°á»ng fullname náº¿u mÃ y muá»‘n lÆ°u thÃªm cÃ³ thá»ƒ gá»­i kÃ¨m
        fullName: document.getElementById("fullname").value.trim()
    };

    const msgEl = document.getElementById("message");
    msgEl.textContent = "â³ Äang xá»­ lÃ½...";

    try {
        const res = await fetch("/api/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });

        if (!res.ok) {
            const text = await res.text();
            throw new Error(text || "ÄÄƒng kÃ½ tháº¥t báº¡i!");
        }

        msgEl.classList.remove("text-danger");
        msgEl.classList.add("text-success");
        msgEl.textContent = "âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng! Kiá»ƒm tra email Ä‘á»ƒ láº¥y mÃ£ OTP xÃ¡c thá»±c.";

        // LÆ°u email táº¡m Ä‘á»ƒ verify
        localStorage.setItem("verifyEmail", body.email);

        // Sau 2s tá»± chuyá»ƒn sang trang xÃ¡c thá»±c OTP
        setTimeout(() => window.location.href = "/verify", 2000);

    } catch (err) {
        msgEl.classList.remove("text-success");
        msgEl.classList.add("text-danger");
        msgEl.textContent = "âŒ " + (err.message || "ÄÄƒng kÃ½ tháº¥t báº¡i, vui lÃ²ng thá»­ láº¡i.");
    }
});
</script>
</body>
</html>
