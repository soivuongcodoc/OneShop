<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Trang chá»§ - OneShop</title>
</head>
<body>
<div class="container mt-5" style="max-width: 700px;">
  <div class="card shadow-sm border-0">
    <div class="card-body text-center">

      <h3 class="text-primary mb-3">ğŸª OneShop - Xin chÃ o!</h3>

      <p class="lead">
        Xin chÃ o <strong id="usernameDisplay">...</strong> ğŸ‘‹  
      </p>

      <div class="mt-4">
        <button class="btn btn-danger me-2" onclick="logout()">ÄÄƒng xuáº¥t</button>
        <button class="btn btn-success" onclick="testProtected()">Gá»i API Ä‘Æ°á»£c báº£o vá»‡</button>
      </div>

      <hr class="my-4">
      <div id="apiResult" class="text-muted"></div>
    </div>
  </div>
</div>

<script>
// âš™ï¸ Láº¥y username vÃ  token
const username = localStorage.getItem("username");
const token = localStorage.getItem("jwtToken");

// Náº¿u chÆ°a Ä‘Äƒng nháº­p thÃ¬ vá» láº¡i login
if (!token) {
  window.location.href = "/login";
}

// Hiá»ƒn thá»‹ username
document.getElementById("usernameDisplay").textContent = username || "NgÆ°á»i dÃ¹ng";

// âœ… HÃ m logout
function logout() {
  localStorage.removeItem("jwtToken");
  localStorage.removeItem("username");
  window.location.href = "/login";
}

// âœ… Gá»i API Ä‘Æ°á»£c báº£o vá»‡ Ä‘á»ƒ test JWT
async function testProtected() {
  const res = await fetch("/api/auth/test", {
    method: "GET",
    headers: {
      "Authorization": "Bearer " + localStorage.getItem("jwtToken")
    }
  });

  const text = await res.text();
  const el = document.getElementById("apiResult");
  if (res.ok) {
    el.classList.remove("text-danger");
    el.classList.add("text-success");
    el.textContent = "âœ… Server pháº£n há»“i: " + text;
  } else {
    el.classList.remove("text-success");
    el.classList.add("text-danger");
    el.textContent = "âŒ Token khÃ´ng há»£p lá»‡ hoáº·c háº¿t háº¡n!";
  }
}
</script>
</body>
</html>
